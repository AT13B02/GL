//*****************************************************************************
//
// オブジェクト3Dバッファクラス
//
// Author		: Kenji Kabutomori
//
//*****************************************************************************

//*****************************************************************************
// インクルード
//*****************************************************************************
// graphic
#include "interface/graphic/object/object_3d/object_3d_buffer.h"
#include "interface/graphic/object/object_3d/object_3d_data.h"

// common
#include "common/common.h"

//*****************************************************************************
// マクロ定義
//*****************************************************************************

//*****************************************************************************
// プロトタイプ宣言
//*****************************************************************************

//*****************************************************************************
// グローバル変数
//*****************************************************************************

//=============================================================================
// コンストラクタ
//=============================================================================
CObject3DBuffer::CObject3DBuffer(void)
{
}

//=============================================================================
// デストラクタ
//=============================================================================
CObject3DBuffer::~CObject3DBuffer(void)
{
}

//=============================================================================
// 初期化
//=============================================================================
bool CObject3DBuffer::Init(void)
{
	return true;
}

//=============================================================================
// 描画
//=============================================================================
void CObject3DBuffer::Draw(CCamera* camera,CTextureManager* texture_manager,CModelManager* model_manager,CRenderstateManager* renderstate_manager)
{
	// TODO zソート

	// リストの開始
	for(auto it = object_3d_data_list_.begin();it != object_3d_data_list_.end();++it)
	{
		// カメラのセット
		(*it)->set_camera(camera);

		// テクスチャマネージャの設定
		(*it)->set_texture_manager(texture_manager);

		// モデルマネージャーの設定
		(*it)->set_model_manager(model_manager);

		// モデルマネージャーの設定
		(*it)->set_renderstate_manager(renderstate_manager);

		// 描画
		(*it)->Draw();
	}
}

//=============================================================================
// 終了
//=============================================================================
void CObject3DBuffer::Uninit(void)
{
	Refresh();
}

//=============================================================================
// 追加
//=============================================================================
void CObject3DBuffer::AddList(CObject3DData* pObject3DData)
{
	// データの追加
	object_3d_data_list_.push_back(pObject3DData);
}

//=============================================================================
// リフレッシュ
//=============================================================================
void CObject3DBuffer::Refresh(void)
{
	// 中身の破棄
	for(auto it = object_3d_data_list_.begin();it != object_3d_data_list_.end();++it)
	{
		SAFE_RELEASE((*it));
	}

	// バッファリストのクリア
	object_3d_data_list_.clear();
}

//---------------------------------- EOF --------------------------------------
